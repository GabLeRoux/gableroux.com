<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Save saltstack console colored output to file</title>

    <meta name="description" content="Not an expert with Salt yet, but wow, saltstack is such a great tool! Like colored output? What about saving colors to your log files?">
    <meta name="author" content="Gabriel Le Breton">

    <link rel="canonical" href="http://gableroux.com/tips/2016/02/09/keep-saltstack-colored-output.html">
    <link rel="alternate" type="application/rss+xml" title="GabLeRoux <Developer>" href="http://gableroux.com/feed.xml"/>

    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">

    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css"/>
    <link rel="stylesheet" href="/bower_components/cyborg-bootstrap/dist/cyborg.bootstrap.min.css"/>
    <link rel="stylesheet" href="/bower_components/font-awesome/css/font-awesome.min.css"/>

    <link rel="stylesheet" href="/css/main.css">

</head>

<body>
<nav class="navbar navbar-default navbar-fixed-top autohide" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse"
                    data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>

        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav">

                
                <li class="home-link">
                    <a href="/">
                        <img src="/images/GabLeRoux-logo-small-white.png"
                             alt=""/>
                    </a>
                </li>
                

                <li class="">
                    <a href="/"><i class="fa fa-home"></i> Home</a>
                </li>

                
                
                
    
        
            <li><a href="/about/">About</a></li>
        
    

    

    

    

    

    

    

    
        
            <li><a href="/todo/">Todo</a></li>
        
    





                <li>
                    <a href="https://totemastudio.com" target="_blank" title="Totema Studio"><i class="fa fa-fire"></i> Totema Studio</a>
                </li>
            </ul>
        </div>
    </div>
</nav>



<main class="containter" id="wrap">
    <div class="container">
        <div class="row">
            <div class="page-content">
                <article class="blog-page">

    <header class="page-header">
        <div class="row">
            <h1 class="page-title">Save saltstack console colored output to file</h1>

            <p class="page-meta">
                Feb 9, 2016
                
            </p>

            <img src="/images/saltstack-colors-output.jpg" alt="Save saltstack console colored output to file">

        </div>
    </header>

    <hr>

    <article class="page-content">
        <p>Not an expert with Salt yet, but wow, saltstack is such a great tool! Like colored output? What about saving colors to your log files?</p>

<!-- more -->

<p>Saltstack’s output has colors for the great good, green when result is pass, pink when it’s modified and red when it fails. Pretty much what you’d expect, easier to see what’s wrong. Now when you start running commands on multiple servers, salt is pretty much handy, but what if you’d like to share the output with a teamate? Go for it, copy paste, plain white/black text. Here’s a solution :)</p>

<h2 id="console-colors-introduction">Console colors introduction</h2>

<p>See <a href="http://www.tldp.org/HOWTO/Bash-Prompt-HOWTO/x329.html">Bash Prompt HOWTO: Colors</a> for reference ;)</p>

<p>Now let’s say I want cyan output</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nv">CYAN</span><span class="o">=</span><span class="s2">"</span><span class="se">\[\0</span><span class="s2">33[0;36m</span><span class="se">\]</span><span class="s2">"</span>
<span class="nv">YELLOW</span><span class="o">=</span><span class="s2">"</span><span class="se">\[\0</span><span class="s2">33[0;33m</span><span class="se">\]</span><span class="s2">"</span>
<span class="nv">NO_COLOUR</span><span class="o">=</span><span class="s2">"</span><span class="se">\[\0</span><span class="s2">33[0m</span><span class="se">\]</span><span class="s2">"</span>
<span class="nb">echo</span> <span class="s2">"</span><span class="nv">$CYAN</span><span class="se">\c</span><span class="s2">olors </span><span class="nv">$NO_COLOUR</span><span class="se">\a</span><span class="s2">re </span><span class="nv">$YELLOW</span><span class="se">\m</span><span class="s2">ainstream"</span></code></pre></figure>

<p>cool (todo: fixme)</p>

<h2 id="keep-colors">Keep colors</h2>

<p>Now, if you write this to a file</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="nb">echo</span> <span class="s2">"</span><span class="nv">$CYAN</span><span class="se">\c</span><span class="s2">olors </span><span class="nv">$NO_COLOUR</span><span class="se">\a</span><span class="s2">re </span><span class="nv">$YELLOW</span><span class="se">\m</span><span class="s2">ainstream"</span> &gt; a_file.txt</code></pre></figure>

<p>Have a look to this file, and it’s plain text.</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">cat a_file.txt
colors are mainstream</code></pre></figure>

<p>Solution: <code class="highlighter-rouge">grep</code> to the rescue</p>

<table>
  <tbody>
    <tr>
      <td>echo “$CYAN\colors $NO_COLOUR\are $YELLOW\mainstream”</td>
      <td>grep –color=always &gt; a_file.txt</td>
    </tr>
  </tbody>
</table>

<p>There are a few options available;</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">grep --color<span class="o">=</span>auto
grep --color<span class="o">=</span>always
grep --color<span class="o">=</span><span class="nb">false</span> <span class="o">(</span>todo: confirm me<span class="o">)</span></code></pre></figure>

<h2 id="read-colored-output-from-file">Read colored output from file</h2>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">cat a_file.txt | less -r</code></pre></figure>

<p><code class="highlighter-rouge">-r</code> is necessary as you’ll see color codes in plain text otherwise, thanks to <a href="http://superuser.com/a/36045/55267">this answer on stackoverflow</a> and it’s first comment.</p>

<h2 id="keep-salt-colored-output">keep salt colored output</h2>

<p>Haven’t talked much about salt, but in our case, salt command has a <code class="highlighter-rouge">--force-color</code> parameter <a href="https://github.com/saltstack/salt/issues/4121">added here</a> which does similar to what grep does as shown above.</p>

<p>Solution to keep salt output looks pretty much like this:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">salt-call state.highstate -l debug --force-color | tee salt.log</code></pre></figure>

<p>Using tee to keep std::out in current console + keeping it’s output in a file at the same time. Since we’re using <code class="highlighter-rouge">--force-color</code>, output keeps color. Now to read <code class="highlighter-rouge">salt.log</code>, you simply use <code class="highlighter-rouge">less -r</code></p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">cat salt.log | less -r</code></pre></figure>

<p>Awesome, salt colors!</p>

    </article>

    

</article>

            </div>
        </div>
    </div>
</main>

<div class="footer-margin-fix">
    <footer class="site-footer clearfix">
        <div class="container">
            <ul class="nav nav-pills">
                <li class="alt">
                    <a href="/">
                        <img src="/images/GabLeRoux-logo-small-white.png"
                             alt="GabLeRoux logo">
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/GabLeRoux" rel="publisher"
                       title="See Gabriel Le Breton's code on GitHub"><i class="fa fa-github-square"></i></a>
                </li>
                
                
                <li>
                    <a href="http://www.facebook.com/gableroux/" target="_blank"
                       title="Stalk Gabriel Le Breton on Facebook"><i class="fa fa-facebook-square fa-fw"></i></a>
                </li>
                
                
                <li>
                    <a href="http://twitter.com/gableroux" target="_blank"
                       title="Follow @gableroux"><i class="fa fa-twitter-square fa-fw"></i></a>
                </li>
                
                
                <li>
                    <a href="https://plus.google.com/+GabrielLeBreton" rel="publisher"
                       title="Find Gabriel Le Breton on Google+"><i class="fa fa-google-plus-square fa-fw"></i></a>
                </li>
                
                
                <li>
                    <a href="mailto:gab@gableroux.com" rel="publisher" title="Send an email to Gabriel Le Breton"><i
                            class="fa fa-envelope fa-fw"></i></a>
                </li>
                
                <li class="rss"><a href="
                    http://gableroux.com/feed.xml" title="Follow rss feed"><i
                        class="fa fa-rss fa-fw"></i></a>
                </li>
            </ul>
        </div>
    </footer>
</div>

<script src="/bower_components/jquery/dist/jquery.min.js"
        type="application/javascript"></script>
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"
        type="application/javascript"></script>
<script src="/bower_components/bootstrap-autohidingnavbar/dist/jquery.bootstrap-autohidingnavbar.min.js"
        type="application/javascript"></script>
<script src="/js/main.js"
        type="application/javascript"></script>

<script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-19518991-1']);
    _gaq.push(['_trackPageview']);

    (function () {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
    })();
</script>


</body>

</html>
